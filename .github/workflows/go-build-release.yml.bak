name: Golang Build and Release [wf-backend] # 推荐填写 app_name，统一规范

on:
  workflow_dispatch:
  # push:
  #   tags:
  #     - 'v*'

# ==== 变量修改 开始 ====
env:
  APP_NAME: wf-backend # 应用程序名称，用于二进制文件名，github release 名称等
  APP_PATH: ./cmd/backend # 应用程序路径，相对于仓库根目录，main.go 所在目录
# ==== 变量修改 结束 ====

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-go@v5
        with:
          go-version: '1.22'
          cache: true
      - name: Build agent binary
        run: go build -ldflags="-s -w" -o "${{ env.APP_NAME }}" "${{ env.APP_PATH }}/main.go"
      - name: Create Release & upload agent binary
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ github.ref_name }}
          name: ${{ github.ref_name }}
          files: ${{ env.APP_NAME }}
          token: ${{ github.token }}
